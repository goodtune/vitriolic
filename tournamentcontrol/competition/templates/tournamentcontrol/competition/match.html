{% extends "tournamentcontrol/competition/base.html" %}
{% load i18n %}
{% load common competition %}

{% block page_title %}{% trans match.title %} - {{ match.datetime|date:"jS F, Y @ G:i" }} [{% trans competition.title %} - {% trans season.title %} - {% trans division.title %}]{% endblock %}

{% block body_class %}{{ block.super }} match{% endblock %}

{% block content %}
	{% block heading %}
		<h1>{% trans competition.title %} - {% trans season.title %}</h1>
		{% if match.label or not match.is_final %}
			<h2>{% trans division.title %} - {% if match.label %}{% trans match.label %}{% else %}{% blocktrans with num=match.round %}Round {{ num }}{% endblocktrans %}{% endif %}</h2>
		{% endif %}
	{% endblock %}

	{% with home=match.get_home_team away=match.get_away_team %}
	{% block head-to-head %}
		<table id="match">
			<thead>
				<tr>
					<th colspan="3" class="team big {{ home.club.slug|cssify }}">
						{% url application.name|add:":team" competition=competition.slug season=season.slug division=division.slug team=home.slug as url1 %}
						{% url application.name|add:":team" season=season.slug division=division.slug team=home.slug as url2 %}
						{% url application.name|add:":team" division=division.slug team=home.slug as url3 %}
						<a href="{{ url1|default:url2|default:url3 }}">{% trans home.title %}</a>
					</th>
					<th colspan="3" class="team big {{ away.club.slug|cssify }}">
						{% url application.name|add:":team" competition=competition.slug season=season.slug division=division.slug team=away.slug as url1 %}
						{% url application.name|add:":team" season=season.slug division=division.slug team=away.slug as url2 %}
						{% url application.name|add:":team" division=division.slug team=away.slug as url3 %}
						<a href="{{ url1|default:url2|default:url3 }}">{% trans away.title %}</a>
					</th>
				</tr>
			</thead>
			<tfoot>
				<tr>
					<td colspan="2"></td>
					<td class="points">
						{% if match.in_progress %}
							{{ match.live_scores.0 }}
							<small class="text-muted">LIVE</small>
						{% else %}
							{{ match.home_team_score }}
						{% endif %}
					</td>
					<td colspan="2"></td>
					<td class="points">
						{% if match.in_progress %}
							{{ match.live_scores.1 }}
							<small class="text-muted">LIVE</small>
						{% else %}
							{{ match.away_team_score }}
						{% endif %}
					</td>
				</tr>
			</tfoot>
			<tbody>
				{% if match.statistics.count %}
					{% statistics match %}
				{% else %}
					{% preview match %}
				{% endif %}
			</tbody>
		</table>
	{% endblock %}
	
	{% if match.in_progress %}
		{% block live_events %}
		<div class="live-events">
			<h3>{% trans "Live Events" %}</h3>
			{% with events=match.events.all %}
				{% if events %}
					<div class="events-timeline">
						{% for event in events %}
							{% if not event.is_reversed %}
								<div class="event-item">
									<span class="event-time">{{ event.timestamp|date:"H:i" }}</span>
									<span class="event-type">{{ event.get_event_type_display }}</span>
									{% if event.home_score_delta %}
										<span class="event-score">+{{ event.home_score_delta }} {{ match.get_home_team.title }}</span>
									{% endif %}
									{% if event.away_score_delta %}
										<span class="event-score">+{{ event.away_score_delta }} {{ match.get_away_team.title }}</span>
									{% endif %}
									{% if event.description %}
										<span class="event-description">{{ event.description }}</span>
									{% endif %}
								</div>
							{% endif %}
						{% endfor %}
					</div>
				{% else %}
					<p class="text-muted">{% trans "No events recorded yet." %}</p>
				{% endif %}
			{% endwith %}
		</div>
		
		<script>
		// Auto-refresh every 30 seconds for live matches
		setTimeout(function() {
			location.reload();
		}, 30000);
		</script>
		
		<style>
		.live-events {
			margin-top: 20px;
			padding: 20px;
			background-color: #f9f9f9;
			border-radius: 5px;
		}
		
		.events-timeline {
			margin-top: 15px;
		}
		
		.event-item {
			margin-bottom: 10px;
			padding: 10px;
			background-color: white;
			border-left: 3px solid #337ab7;
			border-radius: 3px;
		}
		
		.event-time {
			font-weight: bold;
			color: #666;
		}
		
		.event-type {
			margin-left: 10px;
			font-weight: bold;
		}
		
		.event-score {
			margin-left: 10px;
			color: #337ab7;
			font-weight: bold;
		}
		
		.event-description {
			margin-left: 10px;
			font-style: italic;
		}
		
		.text-muted {
			color: #999;
		}
		</style>
		{% endblock %}
	{% endif %}
	
	{% endwith %}
{% endblock %}
