language: python
dist: xenial
cache: pip

python:
  - "3.6"
  - "3.7"
  - "3.8"
  - "3.9"

services:
  - postgresql

addons:
  postgresql: "10"
  apt:
    packages:
      - postgresql-10
      - postgresql-client-10

install:
  - pip install tox-travis

before_script:
  - psql -c "CREATE DATABASE vitriolic;" -U postgres

script:
  - tox

env:
  jobs:
    - DJANGO=2.2
    - DJANGO=3.2
    - DJANGO=4.0
  global:
    - DATABASE_URL=postgresql://postgres@localhost/travis

jobs:
  exclude:
    - python: "3.6"
      env: DJANGO=4.0
    - python: "3.7"
      env: DJANGO=4.0
  fast_finish: true

branches:
  only:
    - develop
    - /^\d+\.\d+\.\d+$/

deploy:
  provider: pypi
  user: goodtune
  distributions: sdist bdist_wheel
  skip_existing: true
  password:
    secure: "tXwXDzgSdnd+mOuXn9KXhowHy+x0ZZQZiAqkfdooTyC5yTLT+LL9keCsN9dm\
             JwEaNTtsp/1vxmX26WhKTMXNrJmvWqgGKut8eRg0atZVD4SmOxl2Ek/QNj4D\
             /fZ8qgzMkVavZFBr82UOj9SIJ7l4HTwf18CGFSWihqPbVrofL86VmyznBPUo\
             4ZBpiBgdtL9QP4qkrr7ECJrwnUY7mobBY+6KE91ELEi7MDUyx/Z2FuSADEJ2\
             xL4lHn5esYZo8isZOsnIbmRFle02ziDdyVPB+5OqHNF+QgqwhBQIrf6rrB3J\
             5ebfEnJwTfvNwx0qeiSd+XxM3xkCKgBqLj37MHkAoTflSu/R146PHuE/QqFs\
             lY90knxibFJuBYNpVkVIaHaeccpZwELKSbzc534sKBe69XRac6g4g3AOootW\
             E7dq/+LpdMlCuQhoowfdRd8asAw8f3n4Oz91GnzYT46BzZBL8eOAK4SFfVSx\
             46ASnhV1pAlUUKIie3IHKVIDBhj72pGVYCRcXpbmP33Kvdpa4fDg5wyHJrH8\
             jTEjyu5bKE68JTNFKTfAosZt/KpATYxq+VlZkdtECXoaiTjMW19jWYc7YOL9\
             LSY7HRq9TzTHQRY98XXbtGFr0dmM7T2zl6kNJJq9MnxCAJjsG9ULUbLhKF58\
             863/LtxhNnwxpECeDboGC+Q="
  on:
    tags: true
    repo: goodtune/vitriolic
    python: 3.9
    condition: $DJANGO = 3.2
